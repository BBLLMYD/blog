<br>

"局部性原理（访问局部性）"这一说法来源于计算机领域，指的是在计算机科学领域中应用程序在访问内存的时候，倾向于访问内存中较为靠近的值。
局部性是出现在计算机系统中的一种可预测行为。系统的这种强访问局部性，可以被用来在处理器内核的指令流水线中进行性能优化，如缓存，内存预读取以及分支预测。


- [关于"局部性"概念讨论]()
- [具体分类]()
- [实际应用]()
- [利弊]()

* * *

### 1.关于"局部性"概念讨论

局部性原理在维基百科的部分描述：
> 在计算机科学中，引用的局部性，也称为局部性原理，是处理器趋向于在短时间内重复访问同一组存储位置的趋势。参考位置有两种基本类型-时间和空间位置。时间局部性是指在相对较小的持续时间内重用特定数据和/或资源。空间局部性（也称为数据局部性）是指在相对靠近的存储位置使用数据元素。顺序局部性是空间局部性的一种特殊情况，它是在数据元素被线性排列和访问时发生的，例如遍历一维数组中的元素。

这个原理好像却又不止于计算机领域，**局部性的本质是概率的不均等**，<br>
既然是数学特性，那么计算机领域的访问局部性现象其实就是一种外化形式。<br>
我认为生活中所见之处到处都在体现着局部性理论，<br>
我们在生活中的各种行为其实也是在一定范围内诠释着"局部性"。<br>
在机器学习与数据挖掘中，熵通常被认为描述一个系统或者分布的不确定性，<br>
我认为正是存在这种数据的多样性和分布不均等作为前置条件，<br>
像概率统计、数据挖掘、机器学习等这一系列的科学技术手段也才有了发展的理由和基础。<br>
这篇主要就来讨论一下，"局部性原理"作为一个抽象的概念或者现象，其在计算机领域的应用。<br>


* * *

### 2.具体分类

局部性原理可以基本分为两大类：时间局部性、空间局部性，以上面两类为基础在应用的特征上也可以再细分为五种。

- 时间局部性：<br>
如果在某一点上引用了特定的存储位置，则很可能在不久的将来再次引用同一位置。相邻引用之间对同一存储位置存在时间上的接近。在这种情况下，通常会努力将参考数据的副本存储在更快的存储器中，以减少后续参考的等待时间。时间位置是空间位置的一种特殊情况，即当预期位置与当前位置相同时。

- 空间局部性：<br>
如果在特定时间引用了特定的存储位置，则很可能在不久的将来引用附近的存储位置。在这种情况下，通常会尝试猜测当前参考周围区域的大小和形状，为此有必要为以后的参考准备更快的访问权限。这个也比较理解，我们大部分情况下代码都是顺序执行，数据也是顺序访问的。

- 内存局部性：<br>
访问内存时，大概率会访问连续的块，而不是单一的内存地址，其实就是空间局部性在内存上的体现。目前计算机设计中，都是以块/页为单位管理调度存储，其实也是在利用空间局部性来优化性能

- 分支局部性（顺序局部性）：<br>
如果在时空坐标空间中路径的预期部分只有几种可能的替代方法。当指令循环的结构简单，或者条件分支指令的小型系统的可能结果仅限于少数可能性时，就是这种情况。分支位置通常不是空间位置，因为少数可能性可以相互远离，其实大多数情况下某个分支都是被大概率选中的。

- 等距局部性：<br>
位于空间局部性和分支局部性之间。考虑以等距模式访问位置的循环，即，时​​空坐标空间中的路径为虚线。在这种情况下，一个简单的线性函数可以预测在不久的将来将访问哪个位置。


<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/05/0504.png?raw=true" width="887"></div>


* * *

### 3.实际应用

实际上在计算机领域的各种内容中关于局部性访问的应用已经比比皆是，包括硬件到操作系统、再到应用程序的设计。
只是"局部性原理"的概念可能没有刻意抽象出来或者是已经已经进行了良好的黑盒封装。

局部性访问也可看作是二八定律在计算机领域的一种体现，通常情况下总会出现百分之二十的数据被百分之八十的流量访问这种现象。
对于这种现象各种缓存各层缓存也应运而生。


CDN：<br>
CDN服务一般用来缓存一些变化频率比较低的静态资源，也是空间换时间的实现，既可以减少带宽成本，同时响应也更迅速。

CACHE：<br>
缓存是最常见的优化手段，下图分别列出计算机存储结构和应用层对缓存的使用概况。

<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/05/0503.png?raw=true" width="997"></div>
<div align=center>关于"缓存的应用"</div>

JIT：<br>
对热点代码进行编译优化，大幅度提高程序性能。JIT技术使得Java在执行速度上能够不输C/C++这类更底层的语言。

CPU分支预测优化：<br>
CPU分支预测就是顺序局部性的体现，CPU的分支预测器也越来越强大、智能，比如我们比较熟悉的Java中的指令重排在CPU中也有类似的机制。


**从应用程序的角度出发看局部性的简单原则：**
- 重复引用同一个变量的程序有良好的时间局部性。
- 对于具有步长为k的引用模式的程序，步长越小，空间局部性越好
- 有步长为1的引用模式的程序有很好的空间局部性。在存储器中以大步长跳来跳去的程序空间局部性很差
- 循环结构具有良好的空间局部性和时间局部性。循环体越小，循环迭代次数越多，局部性越好。

* * *

### 4.利弊

> 甲之蜜糖，乙之砒霜

总的来说**局部性访问实际上是一种现象**，基于这种现象我们可以做出比如以上针对性的优化，
同时这种概率不均等的现象在一些场景下也可能是我们要极力避免的，
如分布式节点的数据倾斜现象也是由于局部性原理引起，可能导致计算任务耗时过长、资源利用不合理等问题。
**其实访问局部性是属于各类client端的行为特点，而server端要做的往往是针对这种现象如何避免发生糟糕的结果及如何做出更好的优化。**
熟悉局部性原理对我们的工作内容有很强的知道意义。












