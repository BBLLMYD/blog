
分布式系统是一个庞大的课题，随着互联网规模的发展，
基本现在无论是业务系统、存储系统、计算系统等领域都是分布式的架构，
分布式虽然解决了集中式架构一些显著的弊端，
但同时在对于分布式架构的实践中也带来了很多不同的挑战。

> 贾雨村断案时想，原来当官没别的诀窍，无非是看脑袋指挥屁股，还是屁股决定脑袋。

上面的引入《红楼梦》开篇说的其实是一个人坐什么位置，通常决定了他思考的角度和范围。
这在里引用这个内容其实是想说在分布式架构的系统领域也可以类比是同样的道理，
虽然都是分布式的架构，**不同场景下的分布式系统可能更关注和侧重的上层特性也不尽相同**，
比如有的系统是面向数据管理，可能需要在一致性和可用性间权衡；
有的是偏向向数据计算，可能对扩展性和容错性要求较高；
有的是偏向事务管理，可能更注重事务本身的特性。虽然都是分布式的架构，在满足基础的特性的同时对上层特点的要求是多变的。

对于分布式架构系统，有已总结的部分通用特征如下：

- 分布性：分布式系统中的多台计算机都会在空间上随意分布，同时，机器的分布情况也会随时变动；
- 对等性：所有的组件节点都是平等的；
- 并发性：同一个分布式系统中的多个节点，可能会并发的对一些共享资源访问，数据库和缓存存储等等；
- 缺乏全局时钟：因为分布式缺乏一个全局的时钟系列控制，很难定义两个事件的先后顺序
- 故障总是会发生：组成分布式系统的所有计算机，都有可能发生任何形式的故障。

> **分布式系统中 任何介质都是不完美的**

这篇文章就尝试着从抽象的几个角度来看关于分布式架构系统的一些特性。

- [1. 分布式应用分类](https://github.com/BBLLMYD/blog/blob/master/blogs/%E6%8A%BD%E8%B1%A1%E4%B9%8B%E4%BA%8E%E2%80%9C%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E2%80%9D.md#1%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E5%88%86%E7%B1%BB)
- [2. 数据一致性](https://github.com/BBLLMYD/blog/blob/master/blogs/%E6%8A%BD%E8%B1%A1%E4%B9%8B%E4%BA%8E%E2%80%9C%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E2%80%9D.md#2-%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7)
- [3. 关于一致性算法](https://github.com/BBLLMYD/blog/blob/master/blogs/%E6%8A%BD%E8%B1%A1%E4%B9%8B%E4%BA%8E%E2%80%9C%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E2%80%9D.md#3-%E5%85%B3%E4%BA%8E%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95)
- [4. 关于分布式事务](https://github.com/BBLLMYD/blog/blob/master/blogs/%E6%8A%BD%E8%B1%A1%E4%B9%8B%E4%BA%8E%E2%80%9C%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E2%80%9D.md#4-%E5%85%B3%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1)
- [5. 其他 & 总结](https://github.com/BBLLMYD/blog/blob/master/blogs/%E6%8A%BD%E8%B1%A1%E4%B9%8B%E4%BA%8E%E2%80%9C%E5%88%86%E5%B8%83%E5%BC%8F%E5%BA%94%E7%94%A8%E2%80%9D.md#5%E5%85%B6%E4%BB%96--%E6%80%BB%E7%BB%93)

* * *

### 1. 分布式应用分类
**“分布式应用”本身就是一个抽象宽泛的概念，我们常讨论到的具体类型分布式系统从大的方向来看多属在下图中显示的上面两类范围里。**

我认为当谈论某个理论时候其实有必要既抽象的概括也分具体的类型来说，
此时抽象的是理论，具体则是在不同特性的分布式系统，如果过于宽泛的抽象，
实际上对于复杂场景的落地实践不一定能起到很扎实明确的参考。

一种视角是可以主要从分布式业务系统和存储系统的角度来区分

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-1.png?raw=true" width="555"></div>
<br>

CAP、BASE等基础理论以及分布式事务的实践在基于不同类型的分布式应用下有不同的实践特征和侧重点。
当我们讨论分布式事务的时候通常侧重讨论的是在分布式业务系统，
更注重“事务”这个特性本身；
当我们讨论CAP，BASE等分布式基础理论的时候，更多指的是各种分布式存储中间件关于的一致性支持。
从中间件本身出发来看，一致性指的是元数据在不同数据副本间存储的一致问题；
从业务系统看，一致性指的是不同模块间事务逻辑的一致性的问题。
**而它们本质上都是基于对数据状态进行读写操作，所以脱离了数据也就无从谈论一致性问题。**
    

* * *

### 2. 数据一致性

**脱离了具体场景的一致性是一个又宽泛又抽象的概念，
我们更常见到的具体描述多是直接从一致性强弱的角度出发在下面这几个：**

#### 2.1常见的角度描述"一致性"

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-3-1.png?raw=true" width="997"></div>
<br>

因为上图所述的几个特性在存储系统和业务系统中达成的手段往往有很大的差别，所以我们通常可以分别具体的讨论。

#### 2.2从不同视角看待"一致性"
还有另一个方式来看待分布式一致性问题，可以抽象出下面两个角度，我认为这样的角度可能更容易展开讨论。

分为两个方面又展开后对于不同的视角我们可以分别再从一致性的角度和粒度出发，进一步具体的细分。

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-10-1.png?raw=true" width="997"></div>
<br>
        
以上关于分布式应用在各个场景角度下的一致性情况的分解，可以在不同的模型下针对“一致性”本身有不同的理解。

* * *

### 3. 关于一致性算法

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-6-1.png?raw=true" width="521"></div>
<br>

Paxos一致性算法的演化实现版本在保证分布式中间件的"元数据"信息是一个权威的实践方向，甚至有说法认为上几乎所有的一致性算法都是从Paxos演化而来的。

#### 3.1 一致性哈希

* * *

### 4. 关于分布式事务

#### 4.1 分布式事务解决方案
**分布式事务的解决方案其实也比较多，常见的有基于XA协议的N阶段提交、TCC、Saga、消息表等，但并没有适用各种场景的尽善尽美的解决方案，这里从侵入性角度出发分别看分布式事务实现方案**

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-8-1.png?raw=true" width="997"></div>
<br>

重要的并不是各种分布式事务的解决方案，而是每种解决方案在实践中分别对当下场景对更注重的性能、一致性程度、隔离性、可用性等等的关注来取舍。

#### 4.2 业务系统中分布式事务难以完美实现的原因

既然是分布式应用，就基本上都不能离开关于网络的不可靠性的弊端，而基本上各种方案策略也都是对网络在各种情况下的不可靠可能性来做出不同的应对方案，
此时就需要结合业务系统的特性来实践和选型。

<br>
<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/01/1-9-1.png?raw=true" width="997"></div>
<br>

* * *

### 5.其他 & 总结

> 分布式环境网络问题是一等公民

分布式系统通信不管是同步还是异步通信总离不开网络传输，而关于网络的各种不可靠性是个长久的课题。上面的说的“分布式应用”是比较狭义的，没有提到常见的分布式计算系统、分布式文件（也属存储系统）等，实际上在保证分布式系统一致性的践行过程中，我们完全不必拘泥于种种的方法论，更重要的是要了解的各个方法论在其每个步骤中的行为为了解决的实际问题是什么。了解本质后我们才真的能做到针对我们业务场景的特点最大程度最优程度的实现，这样就也不再限于各种方案的名词中，针对当前场景下的不可靠如何最大化的减小以及方案本身带来的成本等元素的取舍。

<br>



