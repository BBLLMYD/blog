
网络协议这种基础设施的内容，在网络世界上一旦广泛普及开，随着时间推移那么它的惯性是一定是很庞大的。
尤其是经过很多检验和历练的成熟协议，通常是很难做到大范围取代的。

无论从使用角度还是普及的范围，TCP都是作为应用层在实现可靠传输时的一个优秀的基础设施。
事务总是有两面性，基于TCP的可靠传输协议做的再好普及的再广泛，也要认清它也一定会有着相应的局限。
**TCP做到可靠传输特性的同时，也必然受制于TCP实现可靠传输所采用的算法和手段。**

下面是QUIC在维基百科的部分描述：

> 快速UDP网络连接（英语：Quick UDP Internet Connections，缩写：QUIC）是一种实验性的网络传输协议。由Google开发，在2013年实现。QUIC使用UDP协议，它在两个端点间创建连线，且支持多路复用连线。在设计之初，QUIC希望能够提供基于TLS/DTLS的网络安全保护，减少数据传输及创建连线时的延迟时间，双向控制带宽，以避免网络拥塞。Google希望使用这个协议来取代HTTPS/HTTP协议，使网页传输速度加快，计划将QUIC提交至互联网工程任务小组（IETF），让它成为下一代的正式网络规范。2015年6月，QUIC的网络草案被正式提交至互联网工程任务组。2018 年 10 月，互联网工程任务组 HTTP 及 QUIC 工作小组正式将基于 QUIC 协议的 HTTP（英语：HTTP over QUIC）重命名为HTTP/3以为确立下一代规范做准备。

但是我认为在基础协议层面上的创新，一定是非常优秀的行为也是一种优秀的创新精神，
尤其是在已有的设施已经有了足够的权威认可和普及度的情况下。
这种方向的创新一旦有了突破和普及，对整个社会运作效率都可能有着大的改善，
当然这么666的事也一定需要足够的成本和人才来支持，有着不太可控的投入产出比，所以这也不是谁都有能力并且有意愿去做的一件事情，甚至可能还需要一定的社会责任感的。

QUIC是基于UDP协议为基础而做的一种实现可靠传输特性的协议。
所以我觉得QUIC放在传输层好像不合适，而放在应用层好像也不是特被合适。
而且这看起来其实是有点奇怪的，传输层就不是个可靠协议基础，在应用层又哪里来的可靠特性的保障呢？
其实可靠的保证都是主要依赖算法层面的设计，原生UDP没有Delievery Garuantee，也没有顺序保证，
比如UDP数据包+序列号，或者UDP数据包+时间戳，在UDP基础上设计协议报头等，有了数据就有算法操作，也就能为实现一些机制需求提供基础的可能性。

QUIC协议实现算法上非常复杂，为了实现基于UDP传输的可靠性，它基本上实现并改进了整个TCP协议的功能，
包括序列号，重传，拥塞控制，流量控制等机制。

这一篇就从下面几个方面简单说一说QUIC协议相关的内容

- [1. 已经有可靠的TCP为什么还要QUIC]()
- [2. QUIC协议都有哪些主要新特性]()
- [3. 基于QUIC协议的应用]()
- [4. 总结]()

---

### 1.已经有可靠的TCP为什么还要QUIC

TCP是由操作系统在内核层面实现的，应用程序可以直接使用，不能直接修改。
应用层受益于封装好的TCP的可靠传输机制，基本无需关心细节，只要需调用操作系统提供出的接口。
但是上层应用的更新迭代非常快速，而TCP的迭代却非常缓慢，原因之一就是操作系统升级很麻烦。
过于稳定的同时，其实也降低了协议本身的灵活性，协议僵化的同时也使得整个中间设备以及机制的僵化。
大家都约定俗成的以TCP协议的模式为基础做可靠性保障的手段，
**这样耦合过于严重实际上对协议本身的迭代也不是很有益，成本过高，有点牵一发要动全身的感觉。**

另外TCP有一些特殊场景下成本会相对较高的特性：

- 可靠性机制导致队头阻塞
1. TCP使用序列号来标识数据的顺序，数据严格按顺序处理，如果前面的数据包丢失，后面的数据也不会再给应用层
2. 机制本身依赖操作系统，应用无法干预。
3. TLS协议层同时也有额外的队头阻塞

- 短链接下建立连接的握手延迟大
1. 三次握手导致的TCP连接建立的延迟。
2. TLS完全握手需要至少2个RTT，简化握手需要1个RTT的握手延迟

<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/12/1201.png?raw=true" alt="HTTPS和QUIC的连接建立" width="666"></div>
<div align=center>HTTPS和QUIC的连接建立</div>
<br>

另外在应用层做可靠机制的传输而不耦合于各种系统内核的实现，可以让协议更加灵活无阻力的拓展。

---

### 2.QUIC协议都有哪些主要新特性

QUIC协议的一些特性：

- 改进的拥塞控制
- 拥塞控制算法的可插拔
- 没有队头阻塞的多路复用
- 网络环境经常变化下的连接迁移
- 加密认证的报文包
- ...

其实以上也行我们可以发现一些事情，就是如果想要保证可靠性，有些事情是一定要做的，比如拥塞控制的算法，
TCP中有四个针对性的算法：慢启动，拥塞避免，快速重传，快速恢复，而换一种协议也不能绕过这一步骤。
不过QUIC的实现方式相比原有的机制会更灵活一些。

再比如TCP在保证可靠性上使用了基于字节序号的Sequence及Ack机制，
QUIC是用的单调递增的Packet Number，由于严格的单调递增机制和算法实现上又避免了TCP重传可能歧异的情况。

QUIC的多路复用的实现上和HTTP2基于TCP的多路复用相比，QUIC多个stream之间互相独立无依赖，
也就是避免了TCP为了保证数据的可靠性时 当前面的stream缺失segment阻塞后续stream的情况。
这样在大量数据传输时从整体上看会将影响降低到最小。

我们知道TCP的确认一条连接标识有基础四元组的概念，这样必然导致环境变化连接断开后的重连操作，
虽然这在应用层也可以尽量做到无感知的假象，但这毕竟受制于TCP的原生机制，对这种连接的变化基本不太可能避免重新建立连接的过程。
而QUIC在连接环境中采用一个64位的随机数作为唯一标识，而不再依赖IP+Port，也就不需要再进行重连了，但是这在理论上其实是存在冲突的概率的，不过实际上冲突的概率极低。

QUIC的特性肯定远不止于此，我所了解的深度和广度也很有限，不过在有限的内容里我们也可以大致了解协议的设计机制和设计方向，这其中的思想对我们或许还是会有些受益和启发的。
QUIC的协议设计相比TCP要更复杂，更直接也全面的方式还是要去看Google发表的相关论文，或者看一些对QUIC协议开源的实现示例。

---

### 3.基于QUIC协议的应用

可以看出QUIC协议可应用的场景很多，在Goole和YouTube一些业务中已经得到了相对比较大范围的应用，
Google甚至透漏整体流量50%的部分都已经来自于Google。
国内也有很多C端的业务在尝试转战或者已经转型到QUIC，如QQ空间、微博等产品，还有一些其他如流媒体、直播等领域，
还有阿里云、腾讯云也都有了对QUIC服务的支持。
QUIC协议本身的特性也更适合一些大量数据低延迟的场景，
我认为业界也会越来越以认可和接受的态度来对待正在不断完善发展的QUIC协议。

---

### 4.总结

<div align=center><img src="https://github.com/BBLLMYD/blog/blob/master/images/12/1202.png?raw=true" alt="HTTPS和QUIC的连接建立" width="666"></div>
<div align=center>QUIC协议相关</div>
<br>

QUIC的想要普及的阻力是很大的，TCP在各个层面的渗透的都已经很深，
所以更大的阻力可能是协议相关的上下文配套设施，如NAT网关、在IP层上启用新协议等。
想要取代TCP基本是不太可能的事情，而且我认为也没有必要，特性不同一定也有不同的场景适用，没有绝对的高低只有相对的适配。
对于协议的应用，不应该有踩一捧一的态度，**任何优秀的协议设计出来都有它的道理和价值及适用场景。**
但是对于有技术实力和创新精神的公司来说，从在局域范围开始对QUIC协议的应用应该是会逐渐多的，
毕竟协议本身的特性一定存在有更适合更匹配的场景。
QUIC未来也会提供许多新的特性，正在不断的完善中，非常期待QUIC协议未来的发展。